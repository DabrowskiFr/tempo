#!/bin/sh
set -eu

if [ -n "${DUNE_SOURCEROOT:-}" ]; then
  ROOT_DIR="${DUNE_SOURCEROOT}/applications"
else
  ROOT_DIR="$(CDPATH= cd -- "$(dirname "$0")" && pwd)"
fi

if [ "${1:-}" = "" ] || [ "${1:-}" = "help" ] || [ "${1:-}" = "--help" ] || [ "${1:-}" = "-h" ]; then
  cat <<'EOT'
Usage:
  dune exec ./applications/run -- <app> [-- <args...>]

Categories:
  advanced:
    game-univ
    refactor
  simple-demos:
    snake-raylib
    boids-raylib
    ca-continuous-raylib
    lenia-raylib
    solar-system-raylib
    logicgroove
    temporalsim
EOT
  exit 0
fi

APP="$1"
shift

case "$APP" in
  game-univ)
    TARGET="$ROOT_DIR/advanced/game-univ/run"
    ;;
  refactor|reactive-reconfiguration-engine)
    TARGET="$ROOT_DIR/advanced/refactor/run"
    ;;
  snake-raylib|boids-raylib|ca-continuous-raylib|lenia-raylib|solar-system-raylib|logicgroove|temporalsim)
    TARGET="$ROOT_DIR/simple-demos/$APP/run"
    ;;
  *)
    echo "Unknown app: $APP" >&2
    echo "Run: dune exec ./applications/run -- help" >&2
    exit 2
    ;;
esac

exec "$TARGET" "$@"
